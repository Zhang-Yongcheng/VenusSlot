{"version":3,"sources":["assets\\scripts\\playEffect.js"],"names":["playEffect","cachedEffectSpriteFrame","node","duration","loop","playNode","getChildByName","cc","Node","active","addChild","playSprite","getComponent","Sprite","addComponent","effectSource","find","t0","co","currentRuntime","lastTickTime","done","p","i","Math","floor","childrenCount","effectName","toString","padStart","spriteFrame","undefined"],"mappings":";;;;;;;;;AAAA;;;;AAEA,IAAMA,UAAU,GAAI,YAAY;AAC9B,MAAMC,uBAAuB,GAAG,EAAhC;AAEA,8CAAO,SAAUD,UAAV,CAAqBE,IAArB,EAA2BC,QAA3B,EAAqCC,IAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAqCA,IAArC;AAAqCA,cAAAA,IAArC,GAA4C,IAA5C;AAAA;;AACDC,YAAAA,QADC,GACUH,IAAI,CAACI,cAAL,CAAoB,QAApB,CADV;;AAEL,gBAAID,QAAQ,KAAK,IAAjB,EAAuB;AACrBA,cAAAA,QAAQ,GAAG,IAAIE,EAAE,CAACC,IAAP,CAAY,QAAZ,CAAX;AACAH,cAAAA,QAAQ,CAACI,MAAT,GAAkB,KAAlB;AACAP,cAAAA,IAAI,CAACQ,QAAL,CAAcL,QAAd;AACD;;AAEGM,YAAAA,UARC,GAQYN,QAAQ,CAACO,YAAT,CAAsBL,EAAE,CAACM,MAAzB,CARZ;;AASL,gBAAIF,UAAU,KAAK,IAAnB,EAAyB;AACvBA,cAAAA,UAAU,GAAGN,QAAQ,CAACS,YAAT,CAAsBP,EAAE,CAACM,MAAzB,CAAb;AACD;;AAXI,kBAaDR,QAAQ,CAACI,MAAT,KAAoB,IAbnB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAiBCM,YAAAA,YAjBD,GAiBgBR,EAAE,CAACS,IAAH,CAAQ,wCAAR,CAjBhB;AAAA;AAoBHX,YAAAA,QAAQ,CAACI,MAAT,GAAkB,IAAlB;;AApBG;AAAA,iBAsBI,IAtBJ;AAAA;AAAA;AAAA;;AAuBKQ,YAAAA,EAvBL,GAuBUC,eAAGC,cAAH,CAAkBC,YAvB5B;AAyBQC,YAAAA,IAzBR,GAyBe,KAzBf;;AAAA;AAAA,kBAyBsBA,IAAI,KAAK,KAzB/B;AAAA;AAAA;AAAA;;AA0BOC,YAAAA,CA1BP,GA0BW,CAACJ,eAAGC,cAAH,CAAkBC,YAAlB,GAAiCH,EAAlC,IAAwCd,QA1BnD;AA2BKoB,YAAAA,CA3BL,GA2BSC,IAAI,CAACC,KAAL,CAAWV,YAAY,CAACW,aAAb,GAA6BJ,CAAxC,CA3BT;;AA4BC,gBAAIC,CAAC,IAAIR,YAAY,CAACW,aAAtB,EAAqC;AACnCH,cAAAA,CAAC,GAAGR,YAAY,CAACW,aAAb,GAA6B,CAAjC;AACAL,cAAAA,IAAI,GAAG,IAAP;AACD;;AAEKM,YAAAA,UAjCP,mBAiCkCJ,CAAC,CAACK,QAAF,GAAaC,QAAb,CAAsB,CAAtB,EAAyB,GAAzB,CAjClC;AAkCKC,YAAAA,WAlCL,GAkCmB7B,uBAAuB,CAAC0B,UAAD,CAlC1C;;AAmCC,gBAAIG,WAAW,KAAKC,SAApB,EAA+B;AAC7B9B,cAAAA,uBAAuB,CAAC0B,UAAD,CAAvB,GAAsCG,WAAW,GAAGf,YAAY,CAACT,cAAb,CAA4BqB,UAA5B,EAAwCf,YAAxC,CAAqDL,EAAE,CAACM,MAAxD,EAAgEiB,WAApH;AACD;;AACDnB,YAAAA,UAAU,CAACmB,WAAX,GAAyBA,WAAzB;AAtCD;AAwCC;;AAxCD;AAAA;AAAA;;AAAA;AAAA,kBA2CG1B,IAAI,KAAK,IA3CZ;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAgDHC,YAAAA,QAAQ,CAACI,MAAT,GAAkB,KAAlB;AAhDG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAUT,UAAV;AAAA,GAAP;AAmDD,CAtDkB,EAAnB;;eAwDeA","sourceRoot":"/","sourcesContent":["import co from './co.cc';\n\nconst playEffect = (function () {\n  const cachedEffectSpriteFrame = {};\n\n  return function* playEffect(node, duration, loop = true) {\n    let playNode = node.getChildByName('Effect');\n    if (playNode === null) {\n      playNode = new cc.Node('Effect');\n      playNode.active = false;\n      node.addChild(playNode);\n    }\n\n    let playSprite = playNode.getComponent(cc.Sprite);\n    if (playSprite === null) {\n      playSprite = playNode.addComponent(cc.Sprite);\n    }\n\n    if (playNode.active === true) {\n      return;\n    }\n\n    const effectSource = cc.find('Canvas/Game/Machine/Performance/Effect');\n\n    try {\n      playNode.active = true;\n\n      while (true) {\n        const t0 = co.currentRuntime.lastTickTime;\n\n        for (let done = false; done === false; ) {\n          const p = (co.currentRuntime.lastTickTime - t0) / duration;\n          let i = Math.floor(effectSource.childrenCount * p);\n          if (i >= effectSource.childrenCount) {\n            i = effectSource.childrenCount - 1;\n            done = true;\n          }\n\n          const effectName = `SlotEffect_${i.toString().padStart(5, '0')}`;\n          let spriteFrame = cachedEffectSpriteFrame[effectName];\n          if (spriteFrame === undefined) {\n            cachedEffectSpriteFrame[effectName] = spriteFrame = effectSource.getChildByName(effectName).getComponent(cc.Sprite).spriteFrame;\n          }\n          playSprite.spriteFrame = spriteFrame;\n\n          yield;\n        }\n\n        if (loop !== true) {\n          break;\n        }\n      }\n    } finally {\n      playNode.active = false;\n    }\n  };\n})();\n\nexport default playEffect;\n"]}