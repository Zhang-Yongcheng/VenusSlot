{"version":3,"sources":["assets\\scripts\\playVideo.js"],"names":["PublicSetUp","require","playVideo","videoPlayerNode","videoBundle","playing","onDone","player","enabled","clip","cc","find","active","name","index","on","play","sound","audioEngine","playEffect","audio1","assetManager","getBundle","list","Math","floor","random","length","String","get","VideoClip","done","load","error","asset","co","waitUntil","getComponent","VideoPlayer"],"mappings":"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","sourceRoot":"/","sourcesContent":["import co from './co.cc';\r\nlet PublicSetUp=require('PublicSetUp');\r\nimport sound from './sound';\r\nconst playVideo = (function () {\r\n  let videoPlayerNode = null;\r\n  let videoBundle = null;\r\n  let playing = false;\r\n\r\n  function onDone(player) {\r\n    player.enabled = false;\r\n    player.clip = null;\r\n    playing = false;\r\n    cc.find('Canvas/Game/Machine/VideoFrame').active=false;\r\n    cc.find('Canvas/Game/Machine/Particle_coin').active=false;\r\n  }\r\n\r\n  return function* playVideo(name,index) {\r\n    if (videoPlayerNode === null) {\r\n      videoPlayerNode = cc.find('Canvas/Game/Machine/Performance/VideoPlayer');\r\n      if (videoPlayerNode === null) {\r\n        return;\r\n      }\r\n\r\n      videoPlayerNode.on('ready-to-play', player => {\r\n        player.enabled = true;\r\n        player.play();\r\n        if(PublicSetUp.sound==1){\r\n            \r\n          cc.audioEngine.playEffect(PublicSetUp.audio1, true);\r\n        }\r\n        if (index === 0){\r\n          cc.find('Canvas/Game/Machine/Particle_coin').active=true;\r\n        }\r\n        \r\n        cc.find('Canvas/Game/Machine/VideoFrame').active=true;\r\n      });\r\n\r\n      videoPlayerNode.on('error', onDone);\r\n\r\n      videoPlayerNode.on('completed', onDone);\r\n    }\r\n\r\n    if (videoBundle == null) {\r\n      videoBundle = cc.assetManager.getBundle('mp4');\r\n      if (videoBundle === null) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (name === 'random') {\r\n      const list = ['LINE_MOVIE_1643105941778', 'LINE_MOVIE_1643105948791'];\r\n      name = list[Math.floor(Math.random() * list.length)];\r\n    }else if(name === 'index'){\r\n\r\n      name = String(index);\r\n    }\r\n\r\n    let clip = videoBundle.get(name, cc.VideoClip);\r\n    if (clip == null) {\r\n      let done = false;\r\n      videoBundle.load(name, cc.VideoClip, (error, asset) => {\r\n        done = true;\r\n        if (!error) {\r\n          clip = asset;\r\n          // clip.addRef();\r\n        }\r\n      });\r\n\r\n      yield co.waitUntil(() => done === true);\r\n    }\r\n\r\n    if (clip != null) {\r\n      videoPlayerNode.getComponent(cc.VideoPlayer).clip = clip;\r\n      playing = true;\r\n      yield co.waitUntil(() => playing === false);\r\n    }\r\n  };\r\n})();\r\n\r\nexport default playVideo;\r\n"]}