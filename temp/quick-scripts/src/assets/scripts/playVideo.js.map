{"version":3,"sources":["assets\\scripts\\playVideo.js"],"names":["PublicSetUp","require","playVideo","videoPlayerNode","videoBundle","playing","onDone","player","enabled","clip","name","cc","find","on","play","audioEngine","playEffect","audio1","active","assetManager","getBundle","list","Math","floor","random","length","get","VideoClip","done","load","error","asset","co","waitUntil","getComponent","VideoPlayer"],"mappings":"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","sourceRoot":"/","sourcesContent":["import co from './co.cc';\r\nlet PublicSetUp=require('PublicSetUp');\r\nconst playVideo = (function () {\r\n  let videoPlayerNode = null;\r\n  let videoBundle = null;\r\n  let playing = false;\r\n\r\n  function onDone(player) {\r\n    player.enabled = false;\r\n    player.clip = null;\r\n    playing = false;\r\n  }\r\n\r\n  return function* playVideo(name) {\r\n    if (videoPlayerNode === null) {\r\n      videoPlayerNode = cc.find('Canvas/Game/Machine/Performance/VideoPlayer');\r\n      if (videoPlayerNode === null) {\r\n        return;\r\n      }\r\n\r\n      videoPlayerNode.on('ready-to-play', player => {\r\n        player.enabled = true;\r\n        player.play();\r\n        cc.audioEngine.playEffect(PublicSetUp.audio1, true);\r\n        \r\n        cc.find('Canvas/Game/Machine/Particle_coin').active=true;\r\n        cc.find('Canvas/Game/Machine/VideoFrame').active=true;\r\n      });\r\n\r\n      videoPlayerNode.on('error', onDone);\r\n\r\n      videoPlayerNode.on('completed', onDone);\r\n    }\r\n\r\n    if (videoBundle == null) {\r\n      videoBundle = cc.assetManager.getBundle('mp4');\r\n      if (videoBundle === null) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (name === 'random') {\r\n      const list = ['LINE_MOVIE_1643105941778', 'LINE_MOVIE_1643105948791'];\r\n      name = list[Math.floor(Math.random() * list.length)];\r\n    }\r\n\r\n    let clip = videoBundle.get(name, cc.VideoClip);\r\n    if (clip == null) {\r\n      let done = false;\r\n      videoBundle.load(name, cc.VideoClip, (error, asset) => {\r\n        done = true;\r\n        if (!error) {\r\n          clip = asset;\r\n          // clip.addRef();\r\n        }\r\n      });\r\n\r\n      yield co.waitUntil(() => done === true);\r\n    }\r\n\r\n    if (clip != null) {\r\n      videoPlayerNode.getComponent(cc.VideoPlayer).clip = clip;\r\n      playing = true;\r\n      yield co.waitUntil(() => playing === false);\r\n    }\r\n  };\r\n})();\r\n\r\nexport default playVideo;\r\n"]}