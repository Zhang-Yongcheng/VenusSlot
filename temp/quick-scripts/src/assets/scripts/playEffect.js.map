{"version":3,"sources":["assets\\scripts\\playEffect.js"],"names":["playEffect","cachedEffectSpriteFrame","node","duration","loop","playNode","getChildByName","cc","Node","active","addChild","playSprite","getComponent","Sprite","addComponent","effectSource","find","t0","co","currentRuntime","lastTickTime","done","p","i","Math","floor","childrenCount","effectName","toString","padStart","spriteFrame","undefined"],"mappings":";;;;;;;;;AAAA;;;;AAEA,IAAMA,UAAU,GAAI,YAAY;AAC9B,MAAMC,uBAAuB,GAAG,EAAhC;AAEA,8CAAO,SAAUD,UAAV,CAAqBE,IAArB,EAA2BC,QAA3B,EAAqCC,IAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAqCA,IAArC;AAAqCA,cAAAA,IAArC,GAA4C,IAA5C;AAAA;;AACDC,YAAAA,QADC,GACUH,IAAI,CAACI,cAAL,CAAoB,QAApB,CADV;;AAEL,gBAAID,QAAQ,KAAK,IAAjB,EAAuB;AACrBA,cAAAA,QAAQ,GAAG,IAAIE,EAAE,CAACC,IAAP,CAAY,QAAZ,CAAX;AACAH,cAAAA,QAAQ,CAACI,MAAT,GAAkB,KAAlB;AACAP,cAAAA,IAAI,CAACQ,QAAL,CAAcL,QAAd;AACD;;AAEGM,YAAAA,UARC,GAQYN,QAAQ,CAACO,YAAT,CAAsBL,EAAE,CAACM,MAAzB,CARZ;;AASL,gBAAIF,UAAU,KAAK,IAAnB,EAAyB;AACvBA,cAAAA,UAAU,GAAGN,QAAQ,CAACS,YAAT,CAAsBP,EAAE,CAACM,MAAzB,CAAb;AACD;;AAXI,kBAaDR,QAAQ,CAACI,MAAT,KAAoB,IAbnB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAiBCM,YAAAA,YAjBD,GAiBgBR,EAAE,CAACS,IAAH,CAAQ,wCAAR,CAjBhB;AAAA;AAoBHX,YAAAA,QAAQ,CAACI,MAAT,GAAkB,IAAlB;;AApBG;AAAA,iBAsBI,IAtBJ;AAAA;AAAA;AAAA;;AAuBKQ,YAAAA,EAvBL,GAuBUC,eAAGC,cAAH,CAAkBC,YAvB5B;AAyBQC,YAAAA,IAzBR,GAyBe,KAzBf;;AAAA;AAAA,kBAyBsBA,IAAI,KAAK,KAzB/B;AAAA;AAAA;AAAA;;AA0BOC,YAAAA,CA1BP,GA0BW,CAACJ,eAAGC,cAAH,CAAkBC,YAAlB,GAAiCH,EAAlC,IAAwCd,QA1BnD;AA2BKoB,YAAAA,CA3BL,GA2BSC,IAAI,CAACC,KAAL,CAAWV,YAAY,CAACW,aAAb,GAA6BJ,CAAxC,CA3BT;;AA4BC,gBAAIC,CAAC,IAAIR,YAAY,CAACW,aAAtB,EAAqC;AACnCH,cAAAA,CAAC,GAAGR,YAAY,CAACW,aAAb,GAA6B,CAAjC;AACAL,cAAAA,IAAI,GAAG,IAAP;AACD;;AAEKM,YAAAA,UAjCP,mBAiCkCJ,CAAC,CAACK,QAAF,GAAaC,QAAb,CAAsB,CAAtB,EAAyB,GAAzB,CAjClC;AAkCKC,YAAAA,WAlCL,GAkCmB7B,uBAAuB,CAAC0B,UAAD,CAlC1C;;AAmCC,gBAAIG,WAAW,KAAKC,SAApB,EAA+B;AAC7B9B,cAAAA,uBAAuB,CAAC0B,UAAD,CAAvB,GAAsCG,WAAW,GAAGf,YAAY,CAACT,cAAb,CAA4BqB,UAA5B,EAAwCf,YAAxC,CAAqDL,EAAE,CAACM,MAAxD,EAAgEiB,WAApH;AACD;;AACDnB,YAAAA,UAAU,CAACmB,WAAX,GAAyBA,WAAzB;AAtCD;AAwCC;;AAxCD;AAAA;AAAA;;AAAA;AAAA,kBA2CG1B,IAAI,KAAK,IA3CZ;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAgDHC,YAAAA,QAAQ,CAACI,MAAT,GAAkB,KAAlB;AAhDG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAUT,UAAV;AAAA,GAAP;AAmDD,CAtDkB,EAAnB;;eAwDeA","sourceRoot":"/","sourcesContent":["import co from './co.cc';\r\n\r\nconst playEffect = (function () {\r\n  const cachedEffectSpriteFrame = {};\r\n\r\n  return function* playEffect(node, duration, loop = true) {\r\n    let playNode = node.getChildByName('Effect');\r\n    if (playNode === null) {\r\n      playNode = new cc.Node('Effect');\r\n      playNode.active = false;\r\n      node.addChild(playNode);\r\n    }\r\n\r\n    let playSprite = playNode.getComponent(cc.Sprite);\r\n    if (playSprite === null) {\r\n      playSprite = playNode.addComponent(cc.Sprite);\r\n    }\r\n\r\n    if (playNode.active === true) {\r\n      return;\r\n    }\r\n\r\n    const effectSource = cc.find('Canvas/Game/Machine/Performance/Effect');\r\n\r\n    try {\r\n      playNode.active = true;\r\n\r\n      while (true) {\r\n        const t0 = co.currentRuntime.lastTickTime;\r\n\r\n        for (let done = false; done === false; ) {\r\n          const p = (co.currentRuntime.lastTickTime - t0) / duration;\r\n          let i = Math.floor(effectSource.childrenCount * p);\r\n          if (i >= effectSource.childrenCount) {\r\n            i = effectSource.childrenCount - 1;\r\n            done = true;\r\n          }\r\n\r\n          const effectName = `SlotEffect_${i.toString().padStart(5, '0')}`;\r\n          let spriteFrame = cachedEffectSpriteFrame[effectName];\r\n          if (spriteFrame === undefined) {\r\n            cachedEffectSpriteFrame[effectName] = spriteFrame = effectSource.getChildByName(effectName).getComponent(cc.Sprite).spriteFrame;\r\n          }\r\n          playSprite.spriteFrame = spriteFrame;\r\n\r\n          yield;\r\n        }\r\n\r\n        if (loop !== true) {\r\n          break;\r\n        }\r\n      }\r\n    } finally {\r\n      playNode.active = false;\r\n    }\r\n  };\r\n})();\r\n\r\nexport default playEffect;\r\n"]}